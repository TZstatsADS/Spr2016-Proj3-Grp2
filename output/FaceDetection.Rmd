---
title: "FaceDetection"
author: "Yanyu Zheng yz2690"
date: "March 6, 2016"
output: html_document
---
# Basic setup
```{r}
setwd("~/Data Science/Project3/cycle3cvd-team2/data")
lib = c("EBImage", "XML","dplyr","adabag")
lapply(lib, library, character.only = TRUE)
```

# Get class
```{r}
dir_images = "../../data_train"
dir_names <- list.files(dir_images)

breed_name = sapply(dir_names,gsub,pattern = "\\_[0-9].*",replacement = "")
cat_breed <- c("Abyssinian", "Bengal", "Birman", "Bombay", "British_Shorthair", "Egyptian_Mau","Maine_Coon", "Persian", "Ragdoll", "Russian_Blue", "Siamese", "Sphynx")

iscat <- breed_name %in% cat_breed
y_cat <- as.numeric(iscat)
```

# Get the face
```{r}
dir_XML = "../../annotations/xmls"
dir_ann = list.files(dir_XML)
dir_names = lapply(dir_ann, gsub, pattern = ".xml", replacement = "")
# dir_names = head(dir_names)
lapply(dir_names,getFace,xmlDir = "../../annotations/xmls",picDir = "../../images",CatDir = "../../Faces/Cat",DogDir = "../../Faces/Dog")
```

# Crop background
```{r}
names = sample(dir_names,100)
pics = lapply(names, readIn, picDir = "../../images")
lapply(pics, cropBack,step=2,thresholdRatio=0.35,thresholdC=0.95)
```

# Find cat face
```{r}
dirCatFaces = "../../faces/cat"
dirDogFaces = "../../faces/dog"
catNames = list.files(dirCatFaces)
dogNames = list.files(dirDogFaces)
catPatchs = catNames %>%
  sample(size = 1000) %>%
  standardFace(picDir = dirCatFaces) %>%
  lapply(abstractPatch, xmin = 0, ymin = 0, xmax = 30, ymax = 30)

catTestList = sample(catNames,1000)
catTestPic = lapply(catTestList,FUN = readInHead, picDir = dirCatFaces)
catScores = t(sapply(catTestPic,FUN = scorePatchList,patchList = catPatchs))

dogTestList = sample(dogNames,1000)
dogTestPic = lapply(dogTestList,FUN = readInHead, picDir = dirDogFaces)
dogScores = t(sapply(dogTestPic,FUN = scorePatchList,patchList = catPatchs))

scores = rbind(catScores,dogScores)
dataTest = data.frame(group = as.factor(rep(c(0,1),each = 1000)),scores)

play = bagging(group~., dataTest)
```

# Waste Codes
```{r}
###########
##breedList
###########
# breedName = sapply(dirFaceNames,gsub,pattern = "\\_[0-9].*",replacement = "")
# breedList <- vector("list", length(cat_breed))
# names(breedList) <- cat_breed
# for (i in 1:length(cat_breed)){
#   breedList[[cat_breed[i]]] = dirFaceNames[breedName == cat_breed[[i]]]
# }

###########
##meanface
###########
# play = meanFace(abyssinian,5)
# play = ifelse(abyssinian[[1]]>median(abyssinian[[1]]),0,1)
# #play = ifelse(play>median(play),0,1)
# display(play)
```

